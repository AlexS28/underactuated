<!DOCTYPE html>

<html xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
 xsi:schemaLocation="http://www.w3.org/1999/xhtml HTMLBook/schema/htmlbook.xsd"
 xmlns="http://www.w3.org/1999/xhtml">

  <head>
    <title>Underactuated Robotics</title>
    <meta name="Underactuated Robotics" content="text/html; charset=utf-8;" />

    <script type="text/javascript">
      function getParameterByName(name) {
        name = name.replace(/[\[]/, "\\[").replace(/[\]]/, "\\]");
        var regex = new RegExp("[\\?&]" + name + "=([^&#]*)"),
          results = regex.exec(location.search);
        return results == null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));
      }

      function revealChapters() {
        var chapter = getParameterByName("chapter");
        if (chapter) {
          //document.getElementById("debug_output").innerHTML="displaying only chapter " + chapter;
          chapter = Number(chapter);
          var chapters = document.getElementsByClassName("chapter");
          var i;
          for (i = 0; i < chapters.length; i++) {
            if ((i+1) != chapter) {
              chapters[i].style.display = "none";
            } else {
              chapters[i].style.counterReset = "chapter " + i;
            }
          }
        }
      }
      </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        extensions: ["tex2jax.js"],
        jax: ["input/TeX", "output/HTML-CSS"],
        TeX: { equationNumbers: {autoNumber: "AMS"} },
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"] ],
          displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
          processEscapes: true
        },
        "HTML-CSS": { availableFonts: ["TeX"] }
      });
    </script>
    <script type="text/javascript"
      src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML">
    </script>

    <link rel="stylesheet" href="highlight/styles/default.css">
    <script src="highlight/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>

    <script type="text/javascript">
      function bibtex(){
        var elibTags=document.getElementsByTagName('elib');
        for(i=0;i<elibTags.length;i++)
        {
          var c = elibTags[i].innerHTML;
          elibTags[i].innerHTML='[<a href="http://groups.csail.mit.edu/locomotion/elib.cgi?b='+c+'">'+(i+1)+'</a>]';
        }
      }
    </script>
    <link rel="stylesheet" type="text/css" href="underactuated.css">
  </head>
  <body data-type="book" class="book" id="htmlbook" onload="bibtex(); revealChapters();">
    <section data-type="titlepage" class="titlepage">
      <header>
        <h1>Underactuated Robotics</h1>
        <p data-type="subtitle">Algorithms for Walking, Running, Swimming, Flying, and Manipulation</p>
      	<p data-type="author">Russ Tedrake</p>
        <p data-type="copyright">&copy; Russ Tedrake, 2014</p>
      </header>
    </section>
    <div style="display:none"> <!-- definitions for mathjax -->
      \[
      \newcommand{\bq}{{\bf q}}
      \newcommand{\bv}{{\bf v}}
      \newcommand{\bx}{{\bf x}}
      \newcommand{\by}{{\bf y}}
      \newcommand{\bu}{{\bf u}}
      \newcommand{\bw}{{\bf w}}
      \newcommand{\bz}{{\bf z}}
      \newcommand{\bK}{{\bf K}}
      \newcommand{\balpha}{{\bf \alpha}}
      \newcommand{\bbeta}{{\bf \beta}}
      \newcommand{\avg}[1]{E\left[ #1 \right]}
      \newcommand{\subjto}{\textrm{subject to}}
      \renewcommand{\minimize}{\operatorname{\textrm{minimize}}}
      \renewcommand{\maximize}{\operatorname{\textrm{maximize}}}
      \]
    </div>
    <div id="debug_output"></div>
    <section data-type="chapter" class="chapter">
      <h1>Fully-actuated vs Underactuated Systems</h1>

      <p>Robots today move far too conservatively, and accomplish only a
        fraction of the tasks and achieve a fraction of the performance that
        they are mechanically capable of.  In many cases, we are still
        fundamentally limited by control technology which matured on rigid
        robotic arms in structured factory environments.  The study of
        underactuated robotics focuses on building control systems which use
        the natural dynamics of the machines in an attempt to achieve
        extraordinary performance in terms of speed, efficiency, or
        robustness.</p>

      <section data-type="sect1">
        <h1>Motivation</h1>
        <p>Let's start with some examples, and some videos.</p>

        <section data-type="sect2">
          <h1>Honda's ASIMO vs. Passive Dynamic Walkers</h1>

          <p>
            The world of robotics changed when, in late 1996, Honda Motor
            Co. announced that they had been working for nearly 15 years (behind
            closed doors) on walking robot technology.  Their designs have
            continued to evolve over the last 12 years, resulting in a humanoid
            robot they call ASIMO (Advanced Step in Innovative MObility).  Honda's
            ASIMO is widely considered to be state of the art in walking
            robots, although there are now many robots with designs and
            performance very similar to ASIMO's.  We will dedicate effort to
            understanding a few of the details of ASIMO when we discuss algorithms for walking... for now I just want you to become familiar
            with the look and feel of ASIMO's movements [watch the asimo video
            below now].
          </p>

          <figure>
            <object name="kaltura_player_1409562873" id="kaltura_player_1409562873" type="application/x-shockwave-flash" allowScriptAccess="always" allowNetworking="all" allowFullScreen="true" height="300" width="100%" data="http://www.kaltura.com/index.php/kwidget/wid/1_bybwc53n/uiconf_id/8700151?autoPlay=false"><param name="allowScriptAccess" value="always" /><param name="allowNetworking" value="all" /><param name="allowFullScreen" value="true" /><param name="bgcolor" value="#000000" /><param name="movie" value="http://www.kaltura.com/index.php/kwidget/wid/1_bybwc53n/uiconf_id/8700151"/><param name="flashVars" value=""/><a href="http://corp.kaltura.com">video platform</a><a href="http://corp.kaltura.com/video_platform/video_management">video management</a><a href="http://corp.kaltura.com/solutions/video_solution">video solutions</a><a href="http://corp.kaltura.com/video_platform/video_publishing">video player</a></object>
            <figcaption>Honda's ASIMO (from <a href="http://world.honda.com/ASIMO/video/">http://world.honda.com/ASIMO/video/</a>)</figcaption>
          </figure>

          <p>
          I hope that your first reaction is to be incredibly impressed with the
          quality and versatility of ASIMO's movements.  Now take a second look.
          Although the motions are very smooth, there is something a little
          unnatural about ASIMO's gait.  It feels a little like an astronaut
          encumbered by a heavy space suit.  In fact this is a reasonable
          analogy... ASIMO is walking a bit like somebody that is unfamiliar with
          his/her dynamics.  It's control system is using high-gain feedback,
          and therefore considerable joint torque, to cancel out the natural
          dynamics of the machine and strictly follow a desired trajectory.
          This control approach comes with a stiff penalty.  ASIMO uses roughly
          20 times the energy (scaled) that a human uses to walk on the flat
          (measured by cost of transport)<elib>Collins05</elib>.  Also, control
          stabilization in this approach only works in a relatively small
          portion of the state space (when the stance foot is flat on the
          ground), so ASIMO can't move nearly as quickly as a human, and cannot
          walk on unmodelled or uneven terrain.
          </p>

          <figure style="margin-left: -100px; margin-right: 100px;">
            <table style="width: 800px; margin:0px; padding:0px;">
            <tr><td width="50%">
            <video width="100%" controls title="If your browser cannot play this video, then download it using the link below.">
              <source src="http://ruina.tam.cornell.edu/research/topics/locomotion_and_robotics/3d_passive_dynamic/from_angle.mpg" type="video/mp4">
            </video><br/>
            <a href="http://ruina.tam.cornell.edu/research/topics/locomotion_and_robotics/3d_passive_dynamic/from_angle.mpg">Download the video</a>
          </td><td width="50%">
            <video width="100%" controls title="If your browser cannot play this video, then download it using the link below.">
              <source src="http://ruina.tam.cornell.edu/research/topics/locomotion_and_robotics/3d_passive_dynamic/from_behind.mpg" type="video/mp4">
            </video><br/>
            <a href="http://ruina.tam.cornell.edu/research/topics/locomotion_and_robotics/3d_passive_dynamic/from_behind.mpg">Download the video</a>
            </td></tr>
            <tr><td colspan="2" style="text-align:center;">
              <figcaption>A 3D passive dynamic walker by Steve Collins and Andy Ruina<elib>Collins01</elib></figcaption>
            <td></tr>
            </table>

          </figure>
<p>
For contrast, let's now consider a very different type of walking
robot, called a passive dynamic walker (PDW).  This "robot" has no motors,
no controllers, no computer, but is still capable of walking stably
down a small ramp, powered only by gravity [watch videos above now].  Most people will agree that the
passive gait of this machine is more natural than ASIMO's; it is
certainly more efficient.  Passive walking machines have a long
history - there are patents for passively walking toys dating back to
the mid 1800's.  We will discuss, in detail, what people know about
the dynamics of these machines and what has been accomplished
experimentally.  This most impressive passive dynamic walker to date
was built by Steve Collins in Andy Ruina's lab at Cornell<elib>Collins01</elib>.
</p>

<p>
Passive walkers demonstrate that the high-gain, dynamics-cancelling
feedback approach taken on ASIMO is not a necessary one.  In fact, the
dynamics of walking is beautiful, and should be exploited - not
cancelled out.
</p>
        </section>

<section data-type="sect2">
  <h1>Birds vs. modern aircraft</h1>

<p>
The story is surprisingly similar in a very different type of machine.
Modern airplanes are extremely effective for steady-level flight in
still air.  Propellers produce thrust very efficiently, and today's
cambered airfoils are highly optimized for speed and/or efficiency.
It would be easy to convince yourself that we have nothing left to
learn from birds.  But, like ASIMO, these machines are mostly confined
to a very conservative, low angle-of-attack flight regime where the
aerodynamics on the wing are well understood.  Birds routinely execute
maneuvers outside of this flight envelope (for instance, when they are
landing on a perch), and are considerably more effective than our best
aircraft at exploiting energy (eg, wind) in the air.  </p>

<p>
As a consequence, birds are extremely efficient flying machines; some
are capable of migrating thousands of kilometers with incredibly small
fuel supplies.  The wandering albatross can fly for hours, or even
days, without flapping its wings - these birds exploit the shear layer
formed by the wind over the ocean surface in a technique called
dynamic soaring.  Remarkably, the metabolic cost of flying for these
birds is indistinguishable from the baseline metabolic
cost<elib>Arnould96</elib>, suggesting that they can travel incredible
distances (upwind or downwind) powered almost completely by gradients
in the wind.  Other birds achieve efficiency through similarly rich
interactions with the air - including formation flying, thermal
soaring, and ridge soaring.  Small birds and large insects, such as
butterflies and locusts, use `gust soaring' to migrate hundreds or
even thousands of kilometers carried primarily by the wind.
</p>

<p>
Birds are also incredibly maneuverable.  The roll rate of a highly
acrobatic aircraft (e.g, the A-4 Skyhawk) is approximately 720
deg/sec<elib>Shyy08</elib>; a barn swallow has a roll rate in excess of 5000
  deg/sec<elib>Shyy08</elib>. Bats can be flying at full-speed in one
direction, and completely reverse direction while maintaining forward
speed, all in just over 2 wing-beats and in a distance less than half
the wingspan<elib>Tian06</elib>.  Although quantitative flow visualization
data from maneuvering flight is scarce, a dominant theory is that the
ability of these animals to produce sudden, large forces for
maneuverability can be attributed to unsteady aerodynamics, e.g., the
animal creates a large suction vortex to rapidly change
direction<elib>Triantafyllou95</elib>.  These astonishing capabilities are
called upon routinely in maneuvers like flared perching,
prey-catching, and high speed flying through forests and caves.  Even
at high speeds and high turn rates, these animals are capable of
incredible agility - bats sometimes capture prey on their wings,
Peregrine falcons can pull 25 G's out of a 240 mph dive to catch a
sparrow in mid-flight<elib>Tucker98</elib>, and even the small birds outside
our building can be seen diving through a chain-link fence to grab a
bite of food.
</p>

<p>
Although many impressive statistics about avian flight have been
recorded, our understanding is partially limited by experimental
accessibility - it's is quite difficult to carefully measure birds (and
the surrounding airflow) during their most impressive maneuvers
without disturbing them.  The dynamics of a swimming fish are closely
related, and can be more convenient to study.  Dolphins have been
known to swim gracefully through the waves alongside ships moving at
20 knots<elib>Triantafyllou95</elib>.  Smaller fish, such as the bluegill
sunfish, are known to possess an escape response in which they propel
themselves to full speed from rest in less than a body length; flow
visualizations indeed confirm that this is accomplished by creating a
large suction vortex along the side of the body<elib>Tytell08</elib> -
similar to how bats change direction in less than a body length.
There are even observations of a dead fish swimming upstream
by pulling energy out of the wake of a cylinder; this passive
propulsion is presumably part of the technique used by rainbow trout
to swim upstream at mating season<elib>Beal06</elib>.
</p>

</section>

<section data-type="sect2">
<h1>The common theme</h1>

<p>
Classical control techniques for robotics are based on the idea that
feedback can be used to override the dynamics of our machines.  These
examples suggest that to achieve outstanding dynamic performance
(efficiency, agility, and robustness) from our robots, we need to
understand how to design control system which take advantage of the
dynamics, not cancel them out.  That is the topic of this course.
</p>

<p>
Surprisingly, there are relatively few formal control ideas that
consider "exploiting" the dynamics.  In order to convince a control
theorist to consider the dynamics (efficiency arguments are not
enough), you have to do something drastic, like taking away his
control authority - remove a motor, or enforce a torque-limit.  These
issues have created a formal class of systems, the underactuated
systems, for which people have begun to more carefully consider the
dynamics of their machines in the context of control.
</p>

        </section>
      </section>


      <section data-type="sect1">
        <h1>Definitions</h1>

        <p>
          According to Newton, the dynamics of mechanical systems are second
          order ($F = ma$).  Their state is given by a vector of positions,
          $\bq$, and a vector of velocities, $\dot{\bq}$, and (possibly) time.
          The general form for a second-order controllable dynamical system is:
          $$\ddot{\bq} = {\bf f}(\bq,\dot{\bq},\bu,t),$$ where $\bu$ is the
          control vector.  As we will see, the dynamics for many of the
          robots that we care about turn out to be affine in commanded torque,
          so let's consider a slightly constrained form:
          \begin{equation}\ddot{\bq} = {\bf f}_1(\bq,\dot{\bq},t) + {\bf
          f}_2(\bq,\dot{\bq},t)\bu \label{eq:f1_plus_f2}.\end{equation}
        </p>

          <div data-type="definition">
            <h1>Fully-Actuated</h1>
          A control system described by equation \ref{eq:f1_plus_f2} is
          fully-actuated in configuration $(\bq,\dot{\bq},t)$ if it is able to
          command an instantaneous acceleration in an arbitrary direction in
          $\bq$: \begin{equation} \textrm{rank}\left[{\bf f}_2
          (\bq,\dot{\bq},t)\right] = \dim\left[\bq\right].\end{equation}
          </div>

        <div data-type="definition"><h1>Underactuated</h1>
        A control system described by equation \ref{eq:f1_plus_f2} is
        underactuated in configuration $(\bq,\dot{\bq},t)$ if it is not able
        to command an instantaneous acceleration in an arbitrary direction in
        $\bq$: \begin{equation} \textrm{rank}\left[{\bf
        f}_2(\bq,\dot{\bq},t)\right] <
        \dim\left[\bq\right]. \label{eq:underactuated_def}\end{equation}
        </div>

        <p>Notice that whether or not a control system is underactuated
        may depend on the state of the system, although for most systems
        (including all of the systems in this book) underactuation is a global
        property of the system.</p>

        <p>
        In words, underactuated control systems are those in which the control
        input cannot accelerate the state of the robot in arbitrary
        directions.  As a consequence, unlike fully-actuated systems,
        underactuated system cannot be commanded to follow arbitrary
        trajectories.  </p>

        <div data-type="example"><h1>Robot Manipulators</h1>

          <figure>
          <img style="align: center; width:250px;" src="figures/simple_double_pend.svg"/>
          <todo>make this image spring to life with a matlab movie<</todo>
          <figcaption>Simple double pendulum</figcaption>
          </figure>

        <p>
        Consider the simple robot manipulator illustrated above.  As described in Appendix A, the
        equations of motion for this system are quite simple to derive, and
        take the form of the standard "manipulator equations":
        $${\bf H}(\bq)\ddot\bq + {\bf C}(\bq,\dot\bq)\dot\bq + {\bf G}(\bq) =
        {\bf B}(\bq)\bu.$$ It is well known that the inertial matrix, ${\bf
        H}(\bq)$ is (always) uniformly symmetric and positive definite, and
        is therefore invertible.  Putting the system into the form of
        equation \ref{eq:f1_plus_f2} yields:
        \begin{align*}\ddot{\bq} =& -{\bf H}^{-1}(\bq)\left[ {\bf C}(\bq,\dot\bq) \dot\bq +
        {\bf G}(\bq) \right]\\ &+ {\bf H}^{-1}(\bq) {\bf B}(\bq) \bu.\end{align*} Because
        ${\bf H}^{-1}(\bq)$ is always full rank, we find that a system
        described by the manipulator equations is fully-actuated if and only
        if ${\bf B}(\bq)$ is full row rank.   For this particular example, $\bq = [\theta_1,\theta_2]^T$ and $\bu =
        [\tau_1,\tau_2]^T$, and ${\bf B}(\bq) = {\bf I}_{2 \times 2}$.  The
        system is fully actuated.</p>

        <todo>make drake elements expandable/collapseable.  nice example here: http://quhno.internetstrahlen.de/myopera/csstests/collapsible-paragraph.html</todo>
        <div data-type="drake"><h1>MATLAB Example</h1>

          <p>
          I personally learn best when I can experiment and get some
          physical intuition.  The <a href="http://drake.mit.edu">companion software for the course</a> should make it easy for you to see this
            system in action.  To try it, make sure you've installed drake, then open MATLAB and run <code>addpath_drake</code>
          (possibly from your <code>startup.m</code>) in the <code>drake</code> directory, then
          try the following lines (one at a time) from the MATLAB command line:

          <pre><code class="matlab">
% a platform independent way to cd into the example directory
cd(fullfile(getDrakePath,'examples','SimpleDoublePendulum'));

% first construct the "robot" or "plant" object
plant = DoublePendPlant;  % check out the code in DoublePendPlant.m

% a visualizer will draw the robot
visualizer = DoublePendVisualizer(plant);
visualizer.inspector();  % (optional) simple gui to examine the joints

% simulate the robot from time=0 to time=5 seconds from random
% initial conditions taken from a Gaussian distribution (using randn)
trajectory = simulate(plant, [0 5], randn(4,1));

% play back the simulation using the cpu clock to get the timing right
visualizer.playback(trajectory);

% if you want to access the manipulator equations programmatically,
% you can use, e.g.:
[H,C_times_v,G,B] = plant.manipulatorEquations()
% which outputs using the abbreviations v for qdot, s1 for sin(q1), etc
          </code></pre>
          </p>
        </div>
        <div data-type="drake"><h1>MATLAB Example (an even simpler version)</h1>

          <p>Note that you don't have to write the dynamics yourself.  The software
          supports a high-level description format for describing robots.  We
          could have alternatively done:
          </p>

<pre><code class="matlab">
cd(fullfile(getDrakePath,'examples','SimpleDoublePendulum'));

% construct the robot from a URDF high-level description file
plant = RigidBodyManipulator('SimpleDoublePendulum.urdf');
visualizer = plant.constructVisualizer();

% all of the other commands will work, e.g.:
trajectory = simulate(plant, [0 5], randn(4,1));
visualizer.playback(trajectory);
[H,C_times_v,G,B] = plant.manipulatorEquations()
</code></pre>

          <p>Make sure you take a peek at the file
            <code>SimpleDoublePendulum.urdf</code>.  Documentation for the input format is
          available on the <a href="http://drake.mit.edu">drake wiki</a>; it supports even
          quite complex robots.
          </p>
        </div>

          <p>
          While the basic double pendulum is fully actuated, imagine the somewhat bizarre case that
          we have a motor to provide torque at the elbow, but no motor at the
          shoulder.  In this case, we have $\bu = \tau_2$, and ${\bf B}(\bq) =
          [0,1]^T$.  This system is clearly underactuated.  While it may sound
          like a contrived example, it turns out that it is almost exactly the dynamics
          we will use to study as our simplest model of walking later in the class.
          </p>

        </div>

        <p>The matrix ${\bf f}_2$ is equation \ref{eq:f1_plus_f2} always has
          dim$[\bq]$ rows, and dim$[\bu]$ columns. Therefore, as in the example,
          one of the most common cases for underactuation, which trivially
          implies that ${\bf f}_2$ is not full row rank, is dim$[\bu] < $
          dim$[\bq]$.  This is the case when a robot has joints with no motors.
          But this is not the only case.  The human body, for instance, has an
          incredible number of actuators (muscles), and in many cases has
          multiple muscles per joint; despite having more actuators that
          position variables, when I jump through the air, there is no
          combination of muscle inputs that can change the ballistic trajectory
          of my center of mass (barring aerodynamic effects).  My control
          system is underactuated.</p>

        <p>For completeness, let's generalize the definition of underactuation to
          systems beyond the second-order control affine systems.
        <div data-type="definition">
          <h1>Underactuated Control Differential Equations</h1>
          An $n$th-order control differential equation control described by the
          equations \begin{equation} \frac{d^n{\bf q}}{dt^n} = f({\bf q}, ..., \frac{d^{n-1}
          {\bf q}}{dt^{n-1}}, t, {\bf u}) \end{equation} is fully actuated in state ${\bf x} = ({\bf q}, ..., \frac{d^{n-1}
          {\bf q}}{dt^{n-1}})$ and time $t$ if the resulting map $f$ is surjective: for every $\frac{d^n{\bf q}}{dt^n} $ there
          exists a ${\bf u}$ which produces the desired response.  Otherwise it
          is underactuated.
        </div>
          It is easy to see that equation \ref{eq:underactuated_def}
          is a sufficient condition for underactuation.  This definition can also
          be extended to discrete-time systems and/or differential inclusions.
        </p>

        <p>A quick note about notation.  When describing the dynamics of rigid-body systems in this class, I will use $\bq$ for positions,
          $\dot{\bq}$ for velocities, and use $\bx$ for the full state ($\bx =
          [\bq,\dot{\bq}]^T$).  There is an important limitation to this
          convention, described in the Appendix<!-- ch:robot_dynamics -->, but it will keep the notes more clean.
          Unless otherwise noted, vectors are always treated as column vectors.
          Vectors and matrices are bold (scalars are not).
        </p>

        </section>
        <section data-type="sect1">
          <h1>Feedback Linearization</h1>

          <p>
            Fully-actuated systems are dramatically easier to control than
            underactuated systems.  The key observation is that, for
            fully-actuated systems with known dynamics (e.g., ${\bf f}_1$ and
            ${\bf f}_2$ are known), it is possible to use feedback to effectively
            change a nonlinear control problem into a linear control problem.  The
            field of linear control is incredibly advanced, and there are many
            well-known solutions for controlling linear systems.
          </p>

          <p>The trick is called feedback linearization.  When ${\bf f}_2$ is full
            row rank, it is invertible.  Consider the nonlinear feedback
            law: $$\bu = {\bf \pi}(\bq,\dot\bq,t) = {\bf f}_2^{-1}(\bq,\dot\bq,t)
            \left[ \bu' - {\bf f}_1(\bq,\dot\bq,t) \right],$$ where $\bu'$ is some
            additional control input.  Applying this feedback controller to
            equation~\ref{eq:f1_plus_f2} results in the linear, decoupled,
            second-order system: $$\ddot{\bq} = \bu'.$$ In other words, if ${\bf
            f}_1$ and ${\bf f}_2$ are known and ${\bf f}_2$ is invertible, then
            we say that the system is "feedback equivalent" to $\ddot{\bq} =
            \bu'$.  There are a number of strong results which generalize this
            idea to the case where ${\bf f}_1$ and ${\bf f}_2$ are estimated,
            rather than known (e.g, <elib>Slotine90</elib>).</p>

          <div data-type="example"><h1>Feedback-Cancellation Double Pendulum</h1>

          <p>
          Let's say that we would like our simple double pendulum to act like a
          simple single pendulum (with damping), whose dynamics are given by:
          \begin{align*}
          \ddot \theta_1 &= -\frac{g}{l}\cos\theta_1 -b\dot\theta_1 \\
          \ddot\theta_2 &= 0.
          \end{align*}
          This is easily achieved using <sidenote>Note that our chosen dynamics do not
            actually stabilize $\theta_2$ - this detail was left out for
            clarity, but would be necessary for any real implementation.</sidenote>
            $$\bu = {\bf B}^{-1}\left[ {\bf C}\dot{\bq} + {\bf G} + {\bf
          H}\begin{bmatrix} -\frac{g}{l}c_1 - b\dot{q}_1 \\ 0 \end{bmatrix}
          \right].$$
          </p>

          <p>
          Since we are embedding a nonlinear dynamics (not a linear one), we
          refer to this as "feedback cancellation", or "dynamic
          inversion".  This idea can, and does, make control look easy - for
          the special case of a fully-actuated deterministic system with known
          dynamics.  For example, it would have been just as easy for me to
          invert gravity. Observe that the control derivations here would not
          have been any more difficult if the robot had 100 joints.
          </p>

          <div data-type="drake"><h1>MATLAB Example</h1>
          You can find scripts which implement both of these examples in drake:
<pre><code class="matlab">
cd(fullfile(getDrakePath,'examples','SimpleDoublePendulum'));
runSimplePend;    % feedback linearization to simulate a pendulum
runSimplePendInv; % and a gravity-inverted pendulum
</code></pre>
            </div>
          </div>

          <p>
          The underactuated systems are not feedback linearizable.  Therefore,
          unlike fully-actuated systems, the control designer has no choice but
          to reason about the nonlinear dynamics of the plant in the control
          design.  This dramatically complicates feedback controller design.
          </p>
        </section>

        <section data-type="sect1"><h1>Input and State Constraints</h1>

          <p>
          Although the dynamic constraints due to missing actuators certainly
          embody the spirit of this course, many of the systems we care about
          could be subject to other dynamic constraints, as well.  For example, the
          actuators on our machines may only be mechanically capable of
          producing some limited amount of torque, or their may be a physical
          obstacle in the free space which we cannot permit our robot to come
          into contact with.
          </p>

          <div data-type="definition"><h1>Input and State Constraints</h1>
          A dynamical system described by $\dot{\bx} = {\bf f}(\bx,\bu,t)$ may be
          subject to one or more constraints described by ${\bf \phi}(\bx,\bu,t)\le0$.
          </div>

          <p>In practice it can useful to separate out constraints which depend
          only on the input, e.g. $\phi(\bu)\le0$, such as actuator limits, as
          they can often be easier to handle than state constraints.  An
          obstacle in the environment might manifest itself as one or more
          constraints that depend only on position, e.g. $\phi(\bq)\le0$.</p>

          <p>By our generalized definition of underactuation, we can see that input and state
          constraints can also cause a system to be underactuated.
          <div data-type="example"><h1>Input limits</h1>
          Consider the constrained second-order linear system \[ \ddot{x} = u, \quad |u| \le 1. \]
          By our definition, this system is underactuated.  For example, there
          is no $u$ which can produce the acceleration $\ddot{x} = 2$.
          </div>
          Input and state constraints can complicate control design in similar
          ways to having an insufficient number of actuators, (i.e., the robot cannot
          follow arbitrary trajectories), and often require similar tools to
          find a control solution.</p>

          <section data-type="sect2"><h1>Nonholonomic constraints</h1>

          <p>
          You might have heard of the term "nonholonomic system" (e.g. <elib>Bloch03</elib>), and be
          thinking about how nonholonomy relates to underactuation.  Briefly, a
          nonholonomic constraint is a constraint on the derivatives of the
          system which cannot be integrated into a constraint on the
          positions of the system.  An automobile or traditional wheeled robot provides a canonical example:
          <div data-type="example"><h1>Wheeled robot</h1>
          Consider a simple model of a wheeled robot who's configuration is
          described by its Cartesian position $x,y$ and its orientation,
          $\theta$, so ${\bf q} = \begin{bmatrix} x, y,
          \theta \end{bmatrix}^T$.  The system is subject to differential
          constraints that prevent side-slip, e.g., \begin{gather*} \dot{x} =
          v \cos\theta \\ \dot{y} = v \sin\theta \\ v = \sqrt{\dot{x}^2 +
          \dot{y}^2} \end{gather*} These constraints cannot be integrated
          into constraint on position--the car can get to any configuration
          $(x,y,\theta)$, it just can't move directly sideways--so they are
          nonholonomic constraints.
          </div>
          Contrast the wheel robot example with a robot on train tracks.  The
          train tracks would represent a holonomic constraint: if the system was
          written down in the $(x,y,\theta)$ coordinates then the differential track constriants
          could be integrated resulting in a description of the system in a
          reduced coordinate system--train tracks are holonomic constraints.
          </p>

          <p>
          A nonholomic constraint like the no-side-slip constraint on the
          wheeled vehicle certainly results in an underactuated system.  The
          converse is not necessarily true--the double pendulum system which is
          missing an actuator is underactauted but would not typically be called
          a nonholonmic system.  However, while the definition of a nonholonomic
          constraint is clear, in my view the definition used in the
          literature for a "nonholonomic system" is more ambiguous&dagger;<sidenote>&dagger; Why,
          for instance, are the Lagrangian equations of motion for the double pendulum--clearly non-integrable--
          not considered nonholonomic constraints?</sidenote>, and we'll
          generally avoid using the term.
          </p>

          </section>
        </section>

        <section data-type="sect1"><h1>Underactuated robotics</h1>

          <p>
          The control of underactuated systems is an open and interesting
          problem in controls - although there are a number of special cases
          where underactuated systems have been controlled, there are relatively
          few general principles.  Now here's the rub... most of the interesting
          problems in robotics are underactuated:
          </p>

          <ul>
          <li> Legged robots are underactuated.  Consider a legged machine with
          $N$ internal joints and $N$ actuators.  If the robot is not bolted
          to the ground, then the degrees of freedom of the system include
          both the internal joints and the six degrees of freedom which define
          the position and orientation of the robot in space.  Since $\bu \in
          \Re^N$ and $\bq \in \Re^{N+6}$, equation \ref{eq:underactuated_def}
          is satisfied.</li>
          <li> (Most) Swimming and flying robots are underactuated.  The story
          is the same here as for legged machines.  Each control surface adds
          one actuator and one DOF.  And this is already a simplification, as
          the true state of the system should really include the
          (infinite-dimensional) state of the flow.</li>
          <li> Robot manipulation is (often) underactuated.  Consider a
          fully-actuated robotic arm.  When this arm is manipulating an object
          w/ degrees of freedom (even a brick has six), it can become
          underactuated.  If force closure is achieved, and maintained, then
          we can think of the system as fully-actuated, because the degrees of
          freedom of the object are constrained to match the degrees of
          freedom of the hand.  That is, of course, unless the manipulated
          object has extra DOFs.</li>
          </ul>

          <p>
          Even fully-actuated and otherwise unconstrained control systems can be improved using the lessons
          from underactuated systems, particularly if there is a need to
          increase the efficiency of their motions or reduce the complexity of
          their designs.</p>

        </section>
      <section data-type="sect1"><h1>Goals for the course</h1>

          <p>
          This course is based on the observation that there are new
          computational tools from optimization theory, control theory, motion
          planning, and even machine learning which be used to design feedback control for
          underactuated systems.  The goal of this
          class is to develop these tools in order to design robots that are
          more dynamic and more agile than the current state-of-the-art.</p>

          <p>
The target audience for the class includes both computer science and
          mechanical/aero students pursuing research in robotics.  Although I
          assume a comfort with linear algebra, ODEs, and MATLAB, the course
          notes will provide most of the material and references required for
          the course.
          </p>
      </section>

      </section>

<section data-type="chapter" class="chapter"><h1>The Simple Pendulum</h1>

  <section data-type="sect1"><h1>Introduction</h1>

<p>
Our goals for this chapter are modest: we'd like to understand the
dynamics of a pendulum.  Why a pendulum?  In part, because the
dynamics of a majority of our multi-link robotics manipulators are
simply the dynamics of a large number of coupled pendula.  Also, the
dynamics of a single pendulum are rich enough to introduce most of the
concepts from nonlinear dynamics that we will use in this text, but
tractable enough for us to (mostly) understand in the next few pages.
</p>

<figure>
  <img width="30%" src="figures/simple_pend.svg"/>
  <figcaption>The simple pendulum</figcaption>
</figure>

<p>
The Lagrangian derivation of the equations
of motion of the simple pendulum yields:
\begin{equation*}
m l^2 \ddot\theta(t) + mgl\sin{\theta(t)} = Q.
\end{equation*}
We'll consider the case where the generalized force,
$Q$, models a damping torque (from friction) plus a control torque input,
$u(t)$: $$Q = -b\dot\theta(t) + u(t).$$
</p>

</section>

<section data-type="sect1"><h1>Nonlinear Dynamics w/ a Constant Torque</h1>

<p>
  Let us first consider the dynamics of the pendulum if it is driven in
a particular simple way: a torque which does not vary with time:
\begin{equation}
ml^2 \ddot\theta + b\dot\theta + mgl \sin\theta = u_0.
\end{equation}
These are relatively simple equations, so we should be able to
integrate them to obtain $\theta(t)$ given
$\theta(0),\dot\theta(0)$... right?  Although it is possible,
integrating even the simplest case ($b = u = 0$) involves elliptic
integrals of the first kind; there is relatively little intuition to
be gained here.
</p>

<p>
This is in stark contrast to the case of linear
systems, where we much of our understanding comes from being able to
explictly integrate the equations.  For instance, for a simple linear
system we have $$\dot{q} =
a q \quad \rightarrow \quad q(t) = q(0) e^{at},$$ and we can
immediately understand that the long-term behavior of the system is a
(stable) decaying exponential if $a<0$, an (unstable) growing
expontential if $a>0$, and that the system does nothing if $a=0$.
Here we are with certainly one of the simplest nonlinear systems we
can imagine, and we can't even solve this system?
</p>

<p>
  All is not lost.  If what we care about is the long-term behavior of
the system, then we can investigate the system using a graphical solution
method.  These methods are described beautifully in a book by Steve
Strogatz<elib>Strogatz94</elib>.

<section data-type="sect2"><h1>The Overdamped Pendulum</h1>

<p>
Let's start by studying a special case, when $\frac{b}{ml^2} \sqrt\frac{g}{l} \gg 1$.
This is the case of heavy damping - for instance if the pendulum was
moving in molasses.  In this case, the damping term dominates the
acceleration term, and we have: $$ml^2 \ddot\theta + b\dot\theta
\approx b\dot\theta = u_0 - mgl\sin\theta.$$ In other words, in the case of
heavy damping, the system looks approximately first-order.  This is a
general property of heavily damped systems, such as fluids at very low Reynolds
number.
</p>

<p>
I'd like to ignore one detail for a moment: the fact that $\theta$
wraps around on itself every $2\pi$.  To be clear, let's write the
system without the wrap-around as: \begin{equation}b\dot{x} = u_0 -
mgl\sin{x}.\label{eq:overdamped_pend_ct}\end{equation} Our goal is to
understand the long-term behavior of this system: to find $x(\infty)$
given $x(0)$.  Let's start by plotting $\dot{x}$ vs $x$ for the case
when $u_0=0$:

<figure>
  <img width="70%" src="figures/pend_sinx.svg"/>
</figure>
</p>

<p>
The first thing to notice is that the system has a number of
<em>fixed points</em> or <em>steady states</em>, which occur whenever
$\dot{x} = 0$.  In this simple example, the zero-crossings are $x^* =
\{..., -\pi, 0, \pi, 2\pi, ...\}$.  When the system is in one of
these states, it will never leave that state.  If the initial
conditions are at a fixed point, we know that $x(\infty)$ will be at
the same fixed point.</p>

<p>Next let's investigate the behavior of the system in the local
vicinity of the fixed points.  Examing the fixed point at $x^* =
\pi$, if the system starts just to the right of the fixed point,
then $\dot{x}$ is positive, so the system will move away from the
fixed point.  If it starts to the left, then $\dot{x}$ is negative,
and the system will move away in the opposite direction.  We'll call
fixed-points which have this property \emph{unstable}.  If we look at
the fixed point at $x^* = 0$, then the story is different:
trajectories starting to the right or to the left will move back
towards the fixed point.  We will call this fixed point \emph{locally
stable}.  More specifically, we'll distinguish between three types of
local stability:
<ul>
  <li>Locally stable in the sense of Lyapunov (i.s.L.).  A fixed
point, $x^*$ is locally stable i.s.L. if for every small $\epsilon$, I
can produce a $\delta$ such that if $\| x(0) - x^* \| < \delta$ then
$\forall t$ $\| x(t) - x^*\| < \epsilon$.  In words, this means that
for any ball of size $\epsilon$ around the fixed point, I can create a
ball of size $\delta$ which guarantees that if the system is started
inside the $\delta$ ball then it will remain inside the $\epsilon$
ball for all of time.</li>
  <li>Locally asymptotically stable.  A fixed point is locally
asymptotically stable if $x(0) = x^* + \epsilon$ implies that
$x(\infty) = x^*$.</li>
  <li>Locally exponentially stable.  A fixed point is locally
exponentially stable if $x(0) = x^* + \epsilon$ implies that $\| x(t)
- x^* \| < Ce^{-\alpha}t$, for some positive constants $C$ and
$\alpha$.</li>
</ul>
An initial condition near a fixed point that is stable in the sense of
Lyapunov may never reach the fixed point (but it won't diverge), near
an asymptotically stable fixed point will reach the fixed point as $t
\rightarrow \infty$, and near an exponentially stable fixed point will
reach the fixed point with a bounded rate.  An exponentially stable
fixed point is also an asymptotically stable fixed point, and for locally
smooth nonlinear systems an asymptotically stable fixed point is also
stable i.s.L.&dagger;<sidenote>&dagger; This is not obvious, but can be shown using a
  Converse Lyapunov Theorem (e.g. <elib>Khalil01</elib>).</sidenote> but the converse of these
  is not necessarily true.
</p>

<p>
  Our graph of $\dot{x}$ vs. $x$ can be used to convince ourselves of
i.s.L. and asymptotic stability.  Exponential stability could
potentially be inferred if the function could be bounded by a
negatively-sloped line through the fixed point, but this requires some
care.  I will graphically illustrate unstable fixed points with open
circles and stable fixed points (i.s.L.) with filled circles.  Next,
we need to consider what happens to initial conditions which begin
farther from the fixed points.  If we think of the dynamics of the
system as a flow on the $x$-axis, then we know that anytime $\dot{x} >
0$, the flow is moving to the right, and $\dot{x} < 0$, the flow is
moving to the left.  If we further annotate our graph with arrows
indicating the direction of the flow, then the entire (long-term)
system behavior becomes clear:

<figure>
  <img width="70%" src="figures/pend_sinx_annotated.svg"/>
</figure>


For instance, we can see that any initial condition $x(0) \in
(\pi,\pi)$ will result in $x(\infty) = 0$.  This region is called the
<em>basin of attraction</em> of the fixed point at $x^* = 0$.
Basins of attraction of two fixed points cannot overlap, and the
manifold separating two basins of attraction is called the
<em>separatrix</em>.  Here the unstable fixed points, at $x^* = \{..,
-\pi, \pi, 3\pi, ...\}$ form the separatrix between the basins
of attraction of the stable fixed points.
</p>

<p>
  As these plots demonstrate, the behavior of a first-order one
dimensional system on a line is relatively constrained.  The system
will either monotonically approach a fixed-point or monotonically move
toward $\pm \infty$.  There are no other possibilities.  Oscillations,
for example, are impossible.  Graphical analysis is a fantastic
analysis tool for many first-order nonlinear systems (not just
pendula); as illustrated by the following example:
</p>


</section> <!-- end of overdamped pend -->

</section> <!-- end of constant torque -->

</section> <!-- end of pendulum chapter -->

  </body>
</html>
